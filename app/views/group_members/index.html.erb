<%# app/views/group_members/index.html.erb %>

<div class="container py-4">
  <div class="d-flex justify-content-between align-items-start mb-3">
    <div>
      <h1 class="h4 mb-1">Members — <%= @group.name %></h1>
      <div class="text-muted small"><%= pluralize(@memberships.size, "member") %></div>
    </div>

    <div class="d-flex gap-2">
      <%= link_to "Back to Group", group_path(@group), class: "btn btn-outline-secondary" %>
    </div>
  </div>

  <div class="row g-3">
    <% @memberships.each do |m| %>
    <% u = m.user %>

    <div class="col-12 col-md-6 col-lg-4">
      <div class="card shadow-sm h-100">
        <div class="card-body d-flex gap-3 align-items-start">

          <!-- Avatar -->
          <div class="flex-shrink-0">
            <% if u.avatar&.attached? %>
            <%= image_tag u.avatar,
                      class: "rounded-circle border",
                      style: "width:56px;height:56px;object-fit:cover;" %>
            <% else %>
            <div class="rounded-circle border bg-light d-flex align-items-center justify-content-center" style="width:56px;height:56px;">
              <span class="text-muted fw-semibold"><%= u.email.first.upcase %></span>
            </div>
            <% end %>
          </div>

          <!-- Info + Controls -->
          <div class="min-w-0 flex-grow-1">
            <div class="fw-semibold text-truncate">
              <%= link_to u.display_name_or_email, profile_path(u), class: "text-decoration-none" %>
            </div>

            <div class="small text-muted text-truncate"><%= u.email %></div>

            <div class="small mt-1">
              <%= link_to "View Profile", profile_path(u), class: "link-secondary" %>
            </div>

            <!-- Role badges -->
            <div class="mt-2 d-flex flex-wrap gap-2">
              <span class="badge bg-secondary">
                Group: <%= m.role.presence || "member" %>
              </span>

              <% if u.admin? %>
              <span class="badge bg-danger">Site Admin</span>
              <% end %>

              <% if u.id == @group.owner_id %>
              <span class="badge bg-info text-dark">Owner</span>
              <% end %>
            </div>

            <hr class="my-3">

            <!-- Actions -->
            <div class="d-flex flex-wrap gap-2">
              <% if u.id != @group.owner_id %>
              <%= button_to "Remove from Group",
                        group_membership_path(@group, m),
                        method: :delete,
                        data: { turbo_confirm: "Remove this member from the group?" },
                        class: "btn btn-sm btn-outline-danger" %>
              <% else %>
              <span class="small text-muted align-self-center">Owner can’t be removed</span>
              <% end %>
            </div>

          </div>

        </div>
      </div>
    </div>
    <% end %>
  </div>
</div>