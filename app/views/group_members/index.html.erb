<div class="container py-4">
  <div class="d-flex justify-content-between align-items-start mb-3">
    <div>
      <h1 class="h4 mb-1">Members â€” <%= @group.name %></h1>
      <div class="text-muted small"><%= pluralize(@memberships.size, "member") %></div>
    </div>

    <div class="d-flex gap-2">
      <%= link_to "Back to Group", group_path(@group), class: "btn btn-outline-secondary" %>
    </div>
  </div>

  <div class="row g-3">
    <% @memberships.each do |m| %>
    <% u = m.user %>

    <div class="col-12 col-md-6 col-lg-4">
      <div class="card shadow-sm h-100">
        <div class="card-body d-flex gap-3 align-items-center">

          <!-- Avatar -->
          <div class="flex-shrink-0">
            <% if u.respond_to?(:avatar) && u.avatar.attached? %>
            <%= image_tag url_for(u.avatar),
                      class: "rounded-circle border",
                      style: "width:56px;height:56px;object-fit:cover;" %>
            <% else %>
            <div class="rounded-circle border bg-light d-flex align-items-center justify-content-center" style="width:56px;height:56px;">
              <span class="text-muted fw-semibold">
                <%= u.email.to_s.first&.upcase %>
              </span>
            </div>
            <% end %>
          </div>

          <!-- Info -->
          <div class="min-w-0">
            <!-- Internal profile link -->
            <div class="fw-semibold text-truncate">
              <%= link_to(
                      (u.respond_to?(:name) && u.name.present?) ? u.name : u.email,
                      profile_path(u),
                      class: "text-decoration-none"
                    ) %>
            </div>

            <div class="small">
              <%= link_to "View Profile", profile_path(u), class: "link-secondary" %>
            </div>

            <!-- 52Frames link -->
            <% if u.respond_to?(:frames_profile_url) && u.frames_profile_url.present? %>
            <div class="small">
              <%= link_to "52Frames Profile",
                        u.frames_profile_url,
                        target: "_blank",
                        rel: "noopener",
                        class: "link-primary" %>
            </div>
            <% elsif u.respond_to?(:frames_username) && u.frames_username.present? %>
            <div class="small">
              <%= link_to "52Frames Profile",
                        "https://52frames.com/#{u.frames_username}",
                        target: "_blank",
                        rel: "noopener",
                        class: "link-primary" %>
            </div>
            <% else %>
            <div class="small text-muted">52Frames profile not set</div>
            <% end %>

            <!-- Role -->
            <% if m.respond_to?(:role) && m.role.present? %>
            <div class="small text-muted">Role: <%= m.role %></div>
            <% end %>
          </div>

        </div>
      </div>
    </div>
    <% end %>
  </div>
</div>