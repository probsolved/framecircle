<%# app/views/groups/_status_strip.html.erb %>

<% if week.present? %>
<% submitted = my_submission.present? %>

<div class="position-sticky top-0 z-3 mb-3">
  <div class="card glass-card">
    <div class="card-body py-2">
      <div class="d-flex flex-column flex-md-row align-items-start align-items-md-center justify-content-between gap-2">

        <div>
          <div class="d-flex align-items-center gap-2 flex-wrap">
            <span class="fw-semibold">This week:</span>
            <span><%= week.title %></span>

            <% if submitted %>
            <span class="badge rounded-pill text-bg-success">Submitted</span>
            <% else %>
            <span class="badge rounded-pill text-bg-warning">Not submitted</span>
            <% end %>

            <% if days_left && days_left >= 0 %>
            <% if days_left == 0 %>
            <span class="badge rounded-pill text-bg-danger">Ends today</span>
            <% elsif days_left == 1 %>
            <span class="badge rounded-pill text-bg-danger">1 day left</span>
            <% elsif days_left <= 3 %>
            <span class="badge rounded-pill text-bg-warning"><%= days_left %> days left</span>
            <% else %>
            <span class="badge rounded-pill text-bg-secondary"><%= days_left %> days left</span>
            <% end %>
            <% end %>

            <% if unread_week.to_i > 0 %>
            <span class="badge rounded-pill text-bg-primary"><%= unread_week %> new</span>
            <% end %>
          </div>

          <div class="small text-muted mt-1">
            <%= week.starts_on.strftime("%b %-d") %> – <%= week.ends_on.strftime("%b %-d, %Y") %>
            <% if unread_group.to_i > unread_week.to_i %>
            • <%= unread_group %> unread in group
            <% end %>
          </div>
        </div>

        <div class="d-grid gap-2 d-md-flex">
          <% if submitted %>
          <%= link_to "View Your Submission",
                    group_week_submission_path(group, week),
                    class: "btn btn-sm btn-outline-primary" %>
          <% else %>
          <%= link_to "Submit for This Week",
                    group_week_submission_path(group, week),
                    class: "btn btn-sm btn-primary" %>
          <% end %>

          <%= link_to "Open Week",
                  group_week_path(group, week),
                  class: "btn btn-sm btn-outline-secondary" %>
        </div>

      </div>
    </div>
  </div>
</div>

<% else %>
<div class="alert alert-info mb-3">
  No open week yet. Create one to get things started.
</div>
<% end %>